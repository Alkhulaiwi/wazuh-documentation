.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: 

Wazuh indexer indices
=====================

An index is a collection of documents that relate to each other. The Wazuh indexer uses indices to store and organize security data for fast retrieval. Wazuh uses the following index patterns to store this data:

-  :ref:`wazuh‑alerts-* <>`: This is the index pattern for alerts generated by the Wazuh server.
-  :ref:`wazuh‑archives-* <>`: This is the index pattern for all events sent to the Wazuh server.
-  :ref:`wazuh‑monitoring-* <>`: This is the index pattern for the status of the Wazuh central components.
-  :ref:`wazuh‑statistics-* <>`: This is the index pattern for statistical information of the Wazuh agents.

You can create a custom index pattern or modify the default index pattern.

Creating custom index pattern
-----------------------------

This section describes creating a custom index pattern, ``my-custom-alerts-*``, alongside the default pattern, ``wazuh-alerts-*``. Switch to the root user and perform the steps below.

#. Stop the Filebeat service:

   .. code-block:: console

      # systemctl stop filebeat

#. Download the Wazuh template and save it into a file (for example, ``template.json``):

   .. code-block:: console

      # curl -so template.json https://raw.githubusercontent.com/wazuh/wazuh/|WAZUH_CURRENT_MINOR|/extensions/elasticsearch/7.x/wazuh-template.json

#. Open the template file and locate this line at the beginning of the file:

   .. code-block:: json

      "index_patterns": [
        "wazuh-alerts-4.x-*",
        "wazuh-archives-4.x-*"
      ],

   Add your custom pattern to look like this:

   .. code-block:: json
      :emphasize-lines: 4

      "index_patterns": [
        "wazuh-alerts-4.x-*",
        "wazuh-archives-4.x-*",
        "my-custom-alerts-*"
      ],

   The asterisk character (``*``) on the index patterns is important because Filebeat will create indices using a name that follows this pattern, which is necessary to apply the proper format to visualize the alerts on the Wazuh dashboard.

#. Save the modifications and insert the new template into the Wazuh indexer. This will replace the existing template:

   .. code-block:: console

      # curl -XPUT -k -u <INDEXER_USERNAME>:<INDEXER_PASSWORD> 'https://<INDEXER_IP_ADDRESS>:9200/_template/wazuh' -H 'Content-Type: application/json' -d @template.json

   Replace ``<INDEXER_USERNAME>`` and ``<INDEXER_PASSWORD>`` with the Wazuh indexer username and password. You can obtain the Wazuh indexer credentials for fresh deployments using the command:

   .. note::
      
      If using the Wazuh OVA, use the default credentials ``admin:admin`` or refer to the :doc:`password management </user-manual/user-administration/password-management>` section.

   .. code-block:: console

      # tar -axf wazuh-install-files.tar wazuh-install-files/wazuh-passwords.txt -O | grep -P "\'admin\'" -A 1

   .. code-block:: none
      :class: output

      {"acknowledged":true}


   .. note::
      
      ``{"acknowledged":true}`` indicates that the template was inserted correctly.


   .. warning::
      
      Perform step 5 only if you want to replace the default alert index pattern ``wazuh-alerts-*`` and/or the default archive index pattern ``wazuh‑archives-*`` with ``my-custom-alerts-*``.

#. Open the Wazuh alerts configuration file ``/usr/share/filebeat/module/wazuh/alerts/manifest.yml`` and optionally the archives file ``/usr/share/filebeat/module/wazuh/archives/manifest.yml`` and replace the index name.

   For example, from:

   .. code-block:: yaml

      - name: index_prefix
        default: wazuh-alerts-

   To this:

   .. code-block:: yaml

      - name: index_prefix
        default: my-custom-alerts-

   .. note::

      The index name must not contain the characters ``#``, ``\``, ``/``, ``*``, ``?``, ``"``, ``<``, ``>``, ``|``, ``,``, and must not start with ``_``, ``-``, or ``+``. Also, all the letters must be lowercase.

#. (Optional) If you want to use the new index pattern by default, open the ``/usr/share/wazuh-dashboard/data/wazuh/config/wazuh.yml`` file and add the below configuration:

   .. code-block:: yaml

      pattern: my-custom-alerts-*

   This will make the Wazuh server automatically create and/or select the new index pattern.

#. Restart Filebeat and the Wazuh server components:

   .. code-block:: console

      # systemctl restart filebeat
      # systemctl restart wazuh-manager
      # systemctl restart wazuh-indexer
      # systemctl restart wazuh-dashboard

.. warning::
   
   If you already have indices created with the previous name, they won't be changed. You can still change to the previous index pattern to see them, or you can perform `reindexing <>`__ to rename the existing indices.

.. thumbnail:: /images/manual/wazuh-indexer/create-custom-alerts-index-pattern.gif
   :title: Creating custom alerts index pattern
   :alt: Creating custom alerts index pattern
   :align: center
   :width: 80%

Checking indices information
----------------------------

You can check for information about Wazuh indices in two ways.

-  Using the web user interface.
-  Making a request to the Wazuh indexer API.

Using the web user interface
^^^^^^^^^^^^^^^^^^^^^^^^^^^^

#. In the Wazuh dashboard upper left menu **☰**, go to **OpenSearch Plugins** > **Index Management**.

   .. thumbnail:: /images/manual/wazuh-indexer/opensearch-plugins-index-management-option.png
      :title: Opensearch plugins Index management menu option
      :alt: Opensearch plugins Index management menu option
      :align: center
      :width: 80%

#. 