.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
  :description: Learn more about the command monitoring configuration. Check out the basic usage, how to monitor running Windows processes, and more. 

Configuration
=============

This section of the documentation shows how to configure the modules responsible for running and monitoring commands, executables, and scripts on endpoints. It also provides the different configuration files available and suitable for different use cases.

Modules
-------

Wazuh provides two modules for monitoring the output of system commands executed on an endpoint. The Command and the Logcollector modules periodically run and monitor commands or executables on Windows, Linux, and macOS endpoints.

Command module
^^^^^^^^^^^^^^

We recommend using the Command module to run and monitor endpoint commands. It provides the following capabilities:

- **Checksum verification**: It verifies and validates the integrity of every executed system binary or script by comparing predefined MD5, SHA1, and SHA256 hashes. This procedure ensures that the binary has not been altered or replaced.

- **Encrypted communication**: All messages exchanged between the Wazuh server and agents are encrypted using AES encryption. This implies that every command output from the Wazuh agents is sent securely to the  Wazuh server.

- **Scheduling execution**: The Command module is flexible and can be configured to run commands on endpoints as follows:

   - Immediately after the Wazuh agent starts.

   - At specific time intervals (:ref:`interval <wodle_command_interval>`).

   - On a particular day of the month (:ref:`day <wodle_command_day>`) represented by the day's number.

   - On a specific day of the week (:ref:`wday <wodle_command_wday>`) represented by the dayâ€™s name.

   - At a particular time (:ref:`time <wodle_command_time>`) of the day represented in the format hh:mm.

A standard command configuration block looks like this:

.. code-block:: xml

   <wodle name="command">
     <disabled>no</disabled>
     <tag>test</tag>
     <command>/bin/bash /root/script.sh</command>
     <interval>1d</interval>
     <ignore_output>no</ignore_output>
     <run_on_start>yes</run_on_start>
     <timeout>0</timeout>
     <verify_md5>11227b11f565de042c48654a241e9d1c</verify_md5>
     <verify_sha1>be705c5a89d7bf74185c86c5c3c562608f6e6478</verify_sha1>
     <verify_sha256>292a188e498caea5c5fbfb0beca413c980e7a5edf40d47cf70e1dbc33e4f395e</verify_sha256>
   </wodle>


+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Options            | Default value | Allowed values                                   | Description                                                                                                                                                                                                                                                                                       | Note                                                                                                                                  |
+====================+===============+==================================================+===================================================================================================================================================================================================================================================================================================+=======================================================================================================================================+
| **Main options**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| disabled           | no            | yes, no                                          | Disables the Command module when set to ``yes``.                                                                                                                                                                                                                                                  |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| tag                | no            | N/A                                              | Tags the command with a descriptive name in the command output. For example, ``test`` in the configuration block above will be present in the command output.                                                                                                                                     |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
|command             |               | - A command                                      | Specifies the path to a command, binary, or script to be executed.                                                                                                                                                                                                                                |                                                                                                                                       |
|                    |               | - Path to a binary                               |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | - Path to a script                               |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
|ignore_output       | no            | yes, no                                          | Specifies whether the output of a command is ignored. When this option is set to ``yes``, the command output is not forwarded to the Wazuh server.                                                                                                                                                |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
|timeout             | N/A           | A positive number                                | Specifies the time (in seconds) for each command to wait for the completion of its execution. When this option is set to ``0``, it will wait indefinitely for the end of the process. If the timeout is any value other than ``0``, then the execution will finish when the set value expires.    |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
|verify_md5          | N/A           | MD5 checksum                                     | Verifies the MD5 sum of the binary or the script to be executed against this value. If the checksum does not match, the command output is ignored.                                                                                                                                                | Verifies only the first argument of the command option if you passed two or more arguments.                                           |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
|verify_sha1         | N/A           | SHA1 checksum                                    | Verifies the SHA1 sum of the binary or the script to be executed against this value. If the checksum does not match, the command output is ignored.                                                                                                                                               | Verifies only the first argument of the command option if you passed two or more arguments.                                           |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
|verify_sha256       | N/A           | SHA256 checksum                                  | Verifies the SHA256 sum of the binary or the script to be executed against this value. If the checksum does not match, the command output is ignored.                                                                                                                                             | Verifies only the first argument of the command option if you passed two or more arguments.                                           |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
|skip_verification   | N/A           | yes, no                                          | Runs the command defined even if the checksum does not match. When set to yes and there is a verification failure, the agent will log that the checksum verification failed but will run the specified command regardless of the failure.                                                         |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| **Scheduling options**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| run_on_start       | yes           | yes, no                                          | Runs the configured command immediately when the Wazuh service starts.                                                                                                                                                                                                                            |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| interval           | 2s            | A positive number that should contain a suffix   | Specifies how often a defined command executes.                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | character indicating a time unit, such as,       |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | s (seconds), m (minutes), h (hours), d (days)    |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| day                | N/A           | Day of the month [1..31]                         | Day of the month to run the command configured.                                                                                                                                                                                                                                                   | When the ``day`` option is set, the interval value must be a multiple of months. By default, the interval is set to a month.          |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| wday               | N/A           |                                                  | Day of the week to run the command configured. This option is not compatible with the ``day`` option.                                                                                                                                                                                             | When the ``wday`` option is set, the interval value must be a multiple of weeks. By default, the interval is set to a week.           |
|                    |               | - sunday/sun                                     |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | - monday/mon                                     |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | - tuesday/tue                                    |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | - wednesday/wed                                  |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | - thursday/thu                                   |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | - friday/fri                                     |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
|                    |               | - saturday/sat                                   |                                                                                                                                                                                                                                                                                                   |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| time               | N/A           | Time of day [hh:mm]                              | When only the ``time`` option is set, the interval value must be a multiple of days or weeks. By default, the interval is set to a day.                                                                                                                                                           |                                                                                                                                       |
+--------------------+---------------+--------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------+