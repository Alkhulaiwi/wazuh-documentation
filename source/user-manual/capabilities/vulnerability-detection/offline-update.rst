.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: Learn more about how to perform the offline update of the Wazuh Vulnerability Detection module in this section of our documentation.

Offline Update
==============

If the Wazuh server isn't directly connected to the Internet, it's still possible to keep the Common Vulnerabilities and Exposures (CVEs) information updated. You can download a database file and  and access it within your local environment or network.

Downloading the Wazuh vulnerabilities file
------------------------------------------

We regularly publish a snapshot of the threat intelligence repository to the Cyber Threat Vulnerability Intelligence (CTI) API. We provide this snapshot as a downloadable file containing the CVE documents. To retrieve the date and link for this compressed file, run a command to query the API like the following.

.. code-block:: console

   response=$(curl -s -X GET |CTI_URL|)
   echo "$response" | jq -r '.data.last_snapshot_at'
   echo "$response" | jq -r '.data.last_snapshot_link'

Configure offline vulnerability detection
-----------------------------------------

To use the Vulnerability Detection module offline, follow these steps.

#. Edit the Wazuh server ``/var/ossec/etc/ossec.conf`` file. Add the file path in the vulnerability detection block. This configures the Wazuh server to locate it.

   .. code-block:: xml
      :emphasize-lines: 5
   
      <vulnerability-detection>
         <enabled>yes</enabled>
         <index-status>yes</index-status>
         <feed-update-interval>60m</feed-update-interval>
         <offline-url>file:///var/path/to/the/cves.file.zip</offline-url>
      </vulnerability-detection>

#. Restart the Wazuh manager.

   .. include:: /_templates/installations/manager/restart_wazuh_manager.rst
