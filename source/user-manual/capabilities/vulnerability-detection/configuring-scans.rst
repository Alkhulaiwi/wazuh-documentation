.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: Learn how to check the Vulnerability Detection module configuration in this section of the documentation.

Configuring vulnerability detection
===================================

The Vulnerability Detection module is enabled by default.

The following configuration block shows a configuration example for the Vulnerability Detection module. You can find the Vulnerability Detection settings in the Wazuh server :doc:`configuration file </user-manual/reference/ossec-conf/index>` at ``/var/ossec/etc/ossec.conf``.

.. code-block:: xml

   <vulnerability-detection>
      <enabled>yes</enabled>
      <index-status>yes</index-status>
      <feed-update-interval>60m</feed-update-interval>
   </vulnerability-detection>

   <indexer>
      <enabled>yes</enabled>
      <hosts>
         <host>https://0.0.0.0:9200</host>
      </hosts>
      <username>admin</username>
      <password>admin</password>
      <ssl>
         <certificate_authorities>
            <ca>/etc/filebeat/certs/root-ca.pem</ca>
         </certificate_authorities>
         <certificate>/etc/filebeat/certs/filebeat.pem</certificate>
         <key>/etc/filebeat/certs/filebeat-key.pem</key>
      </ssl>
   </indexer>

The following configuration block shows a configuration example for Syscollector. You can find these settings in the Windows agent :doc:`configuration file </user-manual/reference/ossec-conf/index>` at ``C:\Program Files (x86)\ossec-agent\ossec.conf``.

 .. code-block:: xml

    <!-- System inventory -->
    <wodle name="syscollector">
      <disabled>no</disabled>
      <interval>1h</interval>
      <scan_on_start>yes</scan_on_start>
      <hardware>yes</hardware>
      <os>yes</os>
      <network>yes</network>
      <packages>yes</packages>
      <hotfixes>yes</hotfixes>
      <ports all="no">yes</ports>
      <processes>yes</processes>
  
      <!-- Database synchronization settings -->
      <synchronization>
        <max_eps>10</max_eps>
      </synchronization>
    </wodle>

The Vulnerability Detection module generates logs in the Wazuh server that trigger alerts. Every alert contains the following fields:

-  **CVE**: The Common Vulnerabilities and Exposures identifier for the corresponding vulnerability.
-  **Title**: Short description of the impact of the vulnerability.
-  **Rationale**: Broad description of the vulnerability.
-  **Severity**: Impact of the vulnerability in terms of security.
-  **Package**: Information about the affected package, including why the package is marked as vulnerable.
-  **Published**: Date when the feed added the vulnerability.
-  **Updated**: Date of the last vulnerability update.
-  **CWE**: The Common Weakness Enumeration reference.
-  **CVSS**: Vulnerability assessment according to the Common Vulnerability Scoring System (versions 2 and 3).
-  **Advisories IDs**: Red Hat security advisories.
-  **References**: URLs with extra information on the vulnerability.
-  **Bugzilla references**: Links to the references of the vulnerability in Bugzilla.

You can see an alert sample below showing the fields with vulnerability data:

.. code-block:: json

   {
     "_index": "wazuh-alerts-4.x-env-1-2023.12.21",
     "_id": "GbjDjYwBFQ8bB6PB2Swg",
     "_version": 1,
     "_score": null,
     "_source": {
       "cluster": {
         "node": "worker_01",
         "name": "wazuh1"
       },
       "input": {
         "type": "log"
       },
       "agent": {
         "ip": "10.0.1.230",
         "name": "RHEL9",
         "id": "002"
       },
       "manager": {
         "name": "wazuh-manager-worker-0"
       },
       "data": {
         "vulnerability": {
           "reference": "https://www.sqlite.org/src/tktview?name=8f157e8010, http://seclists.org/fulldisclosure/2020/Dec/32, http://seclists.org/fulldisclosure/2020/Nov/19, http://seclists.org/fulldisclosure/2020/Nov/20, http://seclists.org/fulldisclosure/2020/Nov/22, http://seclists.org/fulldisclosure/2021/Feb/14, https://www.oracle.com/security-alerts/cpuApr2021.html, https://www.oracle.com/security-alerts/cpuapr2022.html, https://www.sqlite.org/src/info/10fa79d00f8091e5, https://www.sqlite.org/src/timeline?p=version-3.32.3&bt=version-3.32.2, https://cert-portal.siemens.com/productcert/pdf/ssa-389290.pdf, https://security.gentoo.org/glsa/202007-26, https://security.netapp.com/advisory/ntap-20200709-0001/, https://support.apple.com/kb/HT211843, https://support.apple.com/kb/HT211844, https://support.apple.com/kb/HT211847, https://support.apple.com/kb/HT211850, https://support.apple.com/kb/HT211931, https://support.apple.com/kb/HT212147, https://usn.ubuntu.com/4438-1/, https://www.oracle.com/security-alerts/cpujan2021.html, https://www.oracle.com/security-alerts/cpuoct2020.html",
           "severity": "LOW",
           "score": {
             "environmental": "0",
             "version": "2.0",
             "temporal": "0",
             "base": "2.100000"
           },
           "cve": "CVE-2020-15358",
           "package": {
             "install_time": "1683104404",
             "path": " ",
             "size": "1310968",
             "name": "sqlite-libs",
             "description": "This package contains the shared library for sqlite.",
             "type": "rpm",
             "version": "3.34.1-6.el9_1",
             "architecture": "x86_64"
           },
           "scanner": {
             "vendor": "Wazuh"
           },
           "description": "In SQLite before 3.32.3, select.c mishandles query-flattener optimization, leading to a multiSelectOrderBy heap overflow because of misuse of transitive properties for constant propagation.",
           "category": "Packages",
           "classification": "CVSS",
           "enumeration": "CVE",
           "status": "Active"
         },
         "aws": {
           "accountId": "",
           "region": ""
         }
       },
       "rule": {
         "firedtimes": 1300,
         "mail": false,
         "level": 5,
         "pci_dss": [
           "11.2.1",
           "11.2.3"
         ],
         "tsc": [
           "CC7.1",
           "CC7.2"
         ],
         "description": "CVE-2020-15358 affects sqlite-libs",
         "groups": [
           "vulnerability-detector"
         ],
         "id": "23503",
         "gdpr": [
           "IV_35.7.d"
         ]
       },
       "location": "vulnerability-scanner",
       "decoder": {
         "name": "json"
       },
       "id": "1703185470.36314864",
       "timestamp": "2023-12-21T19:04:30.080+0000"
     },
     "fields": {
       "timestamp": [
         "2023-12-21T19:04:30.080Z"
       ]
     },
     "highlight": {
       "cluster.name": [
         "@opensearch-dashboards-highlighted-field@wazuh1@/opensearch-dashboards-highlighted-field@"
       ],
       "rule.groups": [
         "@opensearch-dashboards-highlighted-field@vulnerability-detector@/opensearch-dashboards-highlighted-field@"
       ]
     },
     "sort": [
       1703185470080
     ]
   }

You can see the inventory of all the vulnerable packages installed for any agent by clicking on the **Vulnerability Detection** module on the Wazuh dashboard.

.. thumbnail:: /images/manual/vuln-detector/vuln-inventory01.png
   :title: Vulnerable packages inventory
   :align: center
   :width: 80%

.. thumbnail:: /images/manual/vuln-detector/vuln-inventory02.png
   :title: Vulnerability details in Vulnerable packages inventory
   :align: center
   :width: 80%

Here you can see what certain fields of the alert look like on the dashboard:

.. thumbnail:: /images/manual/vuln-detector/vuln-alert-fields.png
   :title: Fields in vulnerability alert
   :align: center
   :width: 80%

