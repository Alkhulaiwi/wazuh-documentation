.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: Learn how to check the Vulnerability Detection module configuration in this section of the documentation.

Configuring vulnerability detection
===================================

The Vulnerability Detector module is enabled by default.

The following configuration block shows a configuration example for the Vulnerability Detection module. The Vulnerability Detection settings are found in the Wazuh server :doc:`configuration file </user-manual/reference/ossec-conf/index>` at ``/var/ossec/etc/ossec.conf``.

.. code-block:: xml

   <vulnerability-detection>
      <enabled>yes</enabled>
      <index-status>yes</index-status>
      <feed-update-interval>60m</feed-update-interval>
   </vulnerability-detection>

   <indexer>
      <enabled>yes</enabled>
      <hosts>
         <host>https://0.0.0.0:9200</host>
      </hosts>
      <username>admin</username>
      <password>admin</password>
      <ssl>
         <certificate_authorities>
         <ca>/etc/filebeat/certs/root-ca.pem</ca>
         </certificate_authorities>
         <certificate>/etc/filebeat/certs/filebeat.pem</certificate>
         <key>/etc/filebeat/certs/filebeat-key.pem</key>
      </ssl>
   </indexer>

The following configuration block shows a configuration example for Syscollector. These settings are found in the Windows agent :doc:`configuration file </user-manual/reference/ossec-conf/index>` at ``C:\Program Files (x86)\ossec-agent\ossec.conf``.

 .. code-block:: xml

    <!-- System inventory -->
    <wodle name="syscollector">
      <disabled>no</disabled>
      <interval>1h</interval>
      <scan_on_start>yes</scan_on_start>
      <hardware>yes</hardware>
      <os>yes</os>
      <network>yes</network>
      <packages>yes</packages>
      <hotfixes>yes</hotfixes>
      <ports all="no">yes</ports>
      <processes>yes</processes>
  
      <!-- Database synchronization settings -->
      <synchronization>
        <max_eps>10</max_eps>
      </synchronization>
    </wodle>

The Vulnerability Detector module generates logs in the Wazuh server that trigger alerts. Every alert contains the following fields:

-  **CVE**: The Common Vulnerabilities and Exposures identifier for the corresponding vulnerability.
-  **Title**: Short description of the impact of the vulnerability.
-  **Rationale**: Broad description of the vulnerability.
-  **Severity**: Impact of the vulnerability in terms of security.
-  **Package**: Information about the affected package, including why the package is marked as vulnerable.
-  **Published**: Date when the feed added the vulnerability.
-  **Updated**: Date of the last vulnerability update.
-  **CWE**: The Common Weakness Enumeration reference.
-  **CVSS**: Vulnerability assessment according to the Common Vulnerability Scoring System (versions 2 and 3).
-  **Advisories IDs**: Red Hat security advisories.
-  **References**: URLs with extra information on the vulnerability.
-  **Bugzilla references**: Links to the references of the vulnerability in Bugzilla.

You can see an alert sample below showing the fields with vulnerability data:

.. code-block:: json

   "data": {
         "vulnerability": {
           "severity": "High",
           "package": {
             "condition": "Package unfixed",
             "name": "rpm-common",
             "source": "rpm",
             "version": "4.14.2.1+dfsg1-1build2",
             "architecture": "amd64"
           },
           "references": [
             "https://bugzilla.redhat.com/show_bug.cgi?id=1964114",
             "https://github.com/rpm-software-management/rpm/pull/1919",
             "https://bugzilla.suse.com/show_bug.cgi?id=1157880",
             "https://github.com/rpm-software-management/rpm/commit/25a435e90844ea98fe5eb7bef22c1aecf3a9c033",
             "https://access.redhat.com/security/cve/CVE-2021-35938",
             "https://rpm.org/wiki/Releases/4.18.0",
             "https://nvd.nist.gov/vuln/detail/CVE-2021-35938",
             "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-35938",
             "https://ubuntu.com/security/CVE-2021-35938"
           ],
           "cve_version": "4.0",
           "assigner": "secalert@redhat.com",
           "published": "2022-08-25",
           "cwe_reference": "CWE-59",
           "title": "CVE-2021-35938 affects rpm-common",
           "type": "PACKAGE",
           "rationale": "A symbolic link issue was found in rpm. It occurs when rpm sets the desired permissions and credentials after installing a file. A local unprivileged user could use this flaw to exchange the original file with a symbolic link to a security-critical file and escalate their privileges on the system. The highest threat from this vulnerability is to data confidentiality and integrity as well as system availability.",
           "cve": "CVE-2021-35938",
           "cvss": {
             "cvss3": {
               "base_score": "7.800000",
               "vector": {
                 "user_interaction": "none",
                 "integrity_impact": "high",
                 "scope": "unchanged",
                 "confidentiality_impact": "high",
                 "availability": "high",
                 "attack_vector": "local",
                 "access_complexity": "low",
                 "privileges_required": "low"
               }
             }
           },
           "updated": "2022-08-31",
           "status": "Active"
         }
       },
       "rule": {
         "firedtimes": 458,
         "mail": false,
         "level": 10,
         "pci_dss": [
           "11.2.1",
           "11.2.3"
         ],
         "tsc": [
           "CC7.1",
           "CC7.2"
         ],
         "description": "CVE-2021-35938 affects rpm-common",
         "groups": [
           "vulnerability-detector"
         ],
         "id": "23505",
         "gdpr": [
           "IV_35.7.d"
         ]
       },
       "location": "vulnerability-detector",
       "decoder": {
         "name": "json"
       },
       "id": "1664242144.7029312",
       "timestamp": "2022-09-27T04:29:04.491+0300"
     },
     "fields": {
       "data.vulnerability.published": [
         "2022-08-25T00:00:00.000Z"
       ],
       "data.vulnerability.updated": [
         "2022-08-31T00:00:00.000Z"
       ],
       "timestamp": [
         "2022-09-27T01:29:04.491Z"
       ]
     },
     "highlight": {
       "agent.id": [
         "@opensearch-dashboards-highlighted-field@010@/opensearch-dashboards-highlighted-field@"
       ],
       "manager.name": [
         "@opensearch-dashboards-highlighted-field@localhost.localdomain@/opensearch-dashboards-highlighted-field@"
       ],
       "rule.groups": [
         "@opensearch-dashboards-highlighted-field@vulnerability-detector@/opensearch-dashboards-highlighted-field@"
       ]
     },
     "sort": [
       1664242144491
     ]
   }


You can see the inventory of all the vulnerable packages installed for any agent by clicking on the **Vulnerability Detection** module on the Wazuh dashboard.

.. thumbnail:: /images/manual/vuln-detector/vuln-inventory01.png
   :title: Vulnerable packages inventory
   :align: center
   :width: 80%

.. thumbnail:: /images/manual/vuln-detector/vuln-inventory02.png
   :title: Vulnerability details in Vulnerable packages inventory
   :align: center
   :width: 80%

Here you can see what certain fields of the alert look like on the dashboard:

.. thumbnail:: /images/manual/vuln-detector/vuln-alert-fields.png
   :title: Fields in vulnerability alert
   :align: center
   :width: 80%

