.. Copyright (C) 2015, Wazuh, Inc.

.. meta::
   :description: Wazuh detects if installed applications have an unpatched CVE in the monitored system. Learn more about this in this PoC.

Vulnerability Detection
=======================

The Wazuh Vulnerability Detection module plays a crucial role in identifying vulnerabilities in applications and operating systems installed on endpoints. This module actively scans and reports on unpatched Common Vulnerabilities and Exposures (CVEs), enhancing the security posture of the monitored environments.

For a comprehensive understanding of this feature, refer to the :doc:`Vulnerability Detection section </user-manual/capabilities/vulnerability-detection/index>` in the Wazuh documentation.

Infrastructure
--------------

The infrastructure setup for this PoC includes a Wazuh Manager hosted on Ubuntu 22.04 and multiple Agents deployed across various operating systems. These Agents continuously monitor and evaluate the security state of their respective systems.

.. list-table:: Infrastructure Overview
   :widths: 25 75
   :header-rows: 1

   * - **Endpoint**
     - **Description**
   * - **Ubuntu 22.04**
     - **The Vulnerability Detection module scans for system and application vulnerabilities on this Linux endpoint.**
   * - **Windows 10, Windows 11, Alma 9, CentOS 8, Debian 12 and any other valid agent**
     - **These endpoints represent a diverse range of operating systems under continuous monitoring for security vulnerabilities.**

This setup ensures comprehensive coverage across different environments, enhancing the detection and management of potential security threats.


Configuration
-------------

The Vulnerability Detection module is enabled by default. You can perform the following steps on the Wazuh server to ensure that the Wazuh Vulnerability Detection module is enabled and properly configured.

#. Open the ``/var/ossec/etc/ossec.conf`` file on the Wazuh server. Check the following settings.

   -  Vulnerability Detection is enabled.

      .. code-block:: xml
         :emphasize-lines: 2

         <vulnerability-detection>
            <enabled>yes</enabled>
            <index-status>yes</index-status>
            <feed-update-interval>60m</feed-update-interval>
         </vulnerability-detection>

   -  The indexer connection is properly configured.

      .. include:: /_templates/installations/manager/configure_indexer_connection.rst

#. If you made changes to the configuration, restart the Wazuh manager.

   .. code-block:: console

      $ sudo systemctl restart wazuh-manager

Testing the Configuration
-------------------------

To validate the functionality of the Vulnerability Detection module, follow these steps to ensure the system is configured correctly and the agents are communicating effectively with the manager.

1. **Agent Connection**: Verify that each agent is properly connected to the Wazuh Manager. This connection is essential for transmitting system inventory data.

2. **Vulnerability Scanning**:

   - **Package Scanning**: The Vulnerability Detection module will automatically begin scanning the installed packages on each endpoint for known vulnerabilities.

   - **OS Vulnerability Scanning**: Simultaneously, the module scans the operating system for vulnerabilities. This dual scanning approach ensures comprehensive coverage.

3. **Result Visualization**:
   - Once vulnerabilities are identified, they can be viewed in the Wazuh dashboard.

   - In the Wazuh dashboard, locate the "Thread Intelligence" section. This is where you'll find insights into potential threats and vulnerabilities.

   - Within the Thread Intelligence section, look for the "Vulnerability Detection" module. Click on it to access detailed information about vulnerabilities across all endpoints.

   .. thumbnail:: /images/poc/vulnerabilities-section.png
      :title: Detected vulnerability detection section.
      :align: center
      :width: 80%

4. **Continuous Monitoring**: Keep the dashboard open to monitor for new vulnerabilities as they are detected in real-time. Regular observation helps in promptly addressing new security threats.

   - **New alerts**: When new vulnerabilities are detected, they will be displayed as alerts in the events section. These alerts provide detailed information about the vulnerabilities, including their severity level and affected software.
   
   - **Solved alerts**: As vulnerabilities are remediated, the alerts will be marked as solved. This helps in tracking the progress of vulnerability remediation efforts. The remediation is done by applying patches or updates to the affected software or removing the vulnerable packages.

By following these steps, you can effectively test the configuration of the Wazuh Vulnerability Detection module and ensure that it is actively monitoring and reporting vulnerabilities across your networked environments.

Alerts Visualization
--------------------

Dashboard
~~~~~~~~~

This dashboard offers valuable insights into your system's vulnerabilities. It includes:

- **Summary of Top 5 Vulnerabilities**: Quickly identify the most critical vulnerabilities that require immediate attention.

- **Distribution of Vulnerabilities by Severity Levels**: Understand the severity distribution of vulnerabilities, helping you prioritize your response effectively.

- **Most Common Vulnerabilities**: Identify the vulnerabilities that occur most frequently across your system, providing insight into common security risks.

.. thumbnail:: /images/poc/vulnerabilities-dashboard.png
   :title: Vulnerability detection dashboard.
   :align: center
   :width: 80%


Inventory
~~~~~~~~~

The Inventory feature empowers users to search all indexed vulnerabilities using Elastic search capabilities. It offers:

- **Advanced Search Functionality**: Utilize Elastic search to perform detailed searches across all indexed vulnerabilities. With flexible filtering options, you can narrow down your search based on various criteria such as severity, affected software, or vulnerability type.

- **Custom Filters**: Tailor your search using filters of different types, enabling you to refine your results and focus on specific aspects of vulnerabilities that matter most to your organization. Whether it's filtering by CVE ID, affected operating system, or patch status, the Inventory feature provides the flexibility you need to find relevant information efficiently.

- **Detailed Package Information**: Gain access to comprehensive details of vulnerable packages, including version numbers, dependencies, and associated CVEs. This allows you to assess the impact of vulnerabilities accurately and make informed decisions regarding patching and remediation strategies.

.. thumbnail:: /images/poc/vulnerabilities-inventory.png
   :title: Vulnerability detection inventory.
   :align: center
   :width: 80%

Events
~~~~~~

The Event section serves as a comprehensive log of all activity related to vulnerabilities within your system. It offers:

- **Real-time Monitoring**: Stay informed about new vulnerabilities as they occur. The Event section provides real-time updates on newly installed packages provided by syscollector that may introduce security risks to your environment. This enables you to promptly address emerging threats and mitigate potential vulnerabilities before they can be exploited.

- **Visibility into Remediation Actions**: Track the resolution of vulnerabilities. When vulnerabilities are remediated through package upgrades or removals, the Event section records these actions, providing visibility into the remediation process and ensuring accountability for security measures taken.

- **Historical Records**: Access historical data on past events. By maintaining a comprehensive log of all vulnerability-related events, the Event section allows you to analyze trends over time, identify recurring issues, and implement proactive measures to strengthen your system's security posture.

.. note::
   The Event section records events occurring after the initial scan, which establishes a baseline for vulnerability detection. It provides insights into the evolution of vulnerabilities within your system and facilitates proactive security measures.

.. thumbnail:: /images/poc/vulnerabilities-events.png
   :title: Vulnerability detection events - New alerts.
   :align: center
   :width: 80%

.. thumbnail:: /images/poc/vulnerabilities-events_solved.png
   :title: Vulnerability detection events - Solved alerts.
   :align: center
   :width: 80%
